<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Birthday Fate Cards</title>
  <meta name="description" content="An interactive invitation â€” Choose your fate" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700;900&family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet">

  <style>
    /* ===== Tarot Skin (override) ===== */

    :root{
      --bg1:#0b1020;
      --bg2:#130b2b;
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.68);
      --accent:#8b5cf6;
      --accent2:#22c55e;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius: 22px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: "Cormorant Garamond", ui-serif, Georgia, serif;
      --display: "Cinzel", ui-serif, Georgia, serif;
      --gold: #d8b25c;
      --ink: rgba(255,255,255,.92);
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      overflow-x:hidden;

      background:
        radial-gradient(1200px 900px at 20% 10%, rgba(216,178,92,.10), transparent 55%),
        radial-gradient(900px 700px at 80% 30%, rgba(139,92,246,.22), transparent 60%),
        radial-gradient(800px 600px at 60% 90%, rgba(34,197,94,.12), transparent 60%),
        linear-gradient(180deg, #070a14, #0c0720);
    }

    /* subtle stars */
    body:before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:.25;
      background-image:
        radial-gradient(circle at 20% 30%, rgba(255,255,255,.55) 1px, transparent 2px),
        radial-gradient(circle at 70% 20%, rgba(255,255,255,.35) 1px, transparent 2px),
        radial-gradient(circle at 40% 80%, rgba(255,255,255,.25) 1px, transparent 2px);
      background-size: 260px 220px, 320px 280px, 380px 340px;
      background-position: 0 0, 60px 40px, 120px 80px;
      filter: blur(.1px);
    }

    h1{
      font-family: var(--display, var(--sans));
      letter-spacing:.02em;
      margin:0 0 10px;
      font-size:clamp(24px, 4vw, 36px);
      line-height:1.15;
      letter-spacing:-.02em;
    }

    .sub{
      margin:0 0 16px;
      color: rgba(255,255,255,.75);
      font-size:15px;
      line-height:1.75;
      white-space:pre-wrap;
    }

    .wrap{width:min(860px, 100%);}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;opacity:.92;}
    .brand{font-family:var(--mono);font-size:13px;letter-spacing:.3px;color:var(--muted);display:flex;gap:10px;align-items:center;}
    .dot{width:10px;height:10px;border-radius:999px;background:linear-gradient(135deg, var(--accent), #60a5fa);box-shadow:0 0 22px rgba(139,92,246,.55);}
    .pill{font-family:var(--mono);font-size:12px;padding:8px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);color:var(--muted);user-select:none;display:flex;gap:8px;align-items:center;}

    .card{
      position:relative;
      border-radius:var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border: 1px solid rgba(216,178,92,.35);
      box-shadow:var(--shadow);
      padding:28px;
      overflow:hidden;
    }
    .card:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(700px 300px at 30% 0%, rgba(139,92,246,.30), transparent 55%),
        radial-gradient(600px 260px at 85% 18%, rgba(34,197,94,.18), transparent 60%);
      pointer-events:none;
      opacity:.9;
    }
    .card:after{
      content:"";
      position:absolute;
      inset:16px;
      border-radius: calc(var(--radius) - 10px);
      border: 1px solid rgba(216,178,92,.26);
      pointer-events:none;
    }
    .card > *{position:relative; z-index:1;}

    .panel{
      border-radius:18px;
      border: 1px solid rgba(216,178,92,.22);
      background: rgba(0,0,0,.25);
      padding:14px;
    }
    .divider{height:1px;background:rgba(255,255,255,.12);margin:18px 0;}

    .countdown{margin:14px 0 10px;display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px;}
    .tile{
      border-radius:18px;
      border: 1px solid rgba(216,178,92,.22);
      background: rgba(0,0,0,.26);
      padding:14px 12px;
      text-align:center;
    }
    .num{font-family:var(--mono);font-size:22px;font-weight:850;letter-spacing:.4px;color: rgba(255,255,255,.92);}
    .label{margin-top:6px;font-size:12px;color: rgba(216,178,92,.78);font-family:var(--mono);}

    .actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px;}
    button{
      border:0;cursor:pointer;border-radius:14px;padding:12px 14px;
      font-weight:750;letter-spacing:.2px;
      background:rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.16);
      color:var(--text);
      transition: transform .06s ease, background .2s ease, border-color .2s ease, filter .2s ease;
    }
    button:hover{background:rgba(255,255,255,.14);border-color:rgba(255,255,255,.22)}
    button:active{transform:translateY(1px) scale(.99)}
    button:disabled{opacity:.55;cursor:not-allowed}
    .primary{
      background: linear-gradient(135deg, rgba(216,178,92,.90), rgba(139,92,246,.75));
      border-color: rgba(216,178,92,.35);
      box-shadow: 0 16px 40px rgba(139,92,246,.22);
    }
    .green{background:linear-gradient(135deg, rgba(34,197,94,.92), rgba(16,185,129,.88));box-shadow:0 16px 40px rgba(34,197,94,.18);}
    .ghost{background:transparent}

    .cards{margin-top:12px;display:grid;grid-template-columns: repeat(2, minmax(0, 1fr));gap:12px;}
    .fate{
      border-radius:20px;
      border: 1px solid rgba(216,178,92,.30);
      background:
        radial-gradient(500px 220px at 50% 0%, rgba(216,178,92,.10), transparent 60%),
        rgba(0,0,0,.24);
      padding:16px;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      min-height:140px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      position:relative;
      overflow:hidden;
    }
    .fate:before{
      content:"";
      position:absolute;
      inset:12px;
      border-radius:16px;
      border:1px solid rgba(216,178,92,.22);
      pointer-events:none;
    }
    .fate:after{
      content:"âœ¦";
      position:absolute;
      right:14px;
      bottom:12px;
      font-family: var(--display, var(--sans));
      color: rgba(216,178,92,.75);
      opacity:.9;
      pointer-events:none;
    }
    .fate:hover{background:rgba(255,255,255,.11);border-color:rgba(255,255,255,.22)}
    .fate:active{transform:translateY(1px)}
    .fate.disabled{opacity:.65;cursor:not-allowed}

    .fateTop{display:flex;justify-content:space-between;align-items:flex-start;gap:10px;}
    .fateTitle{font-weight:900;font-size:16px;letter-spacing:-.01em;font-family:var(--display, var(--sans));letter-spacing:.03em;}
    .fateHint{margin-top:6px;color:rgba(255,255,255,.66);font-size:13px;line-height:1.6;}
    .fateLabel{
      font-family:var(--mono);
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(0,0,0,.25);
      border: 1px solid rgba(216,178,92,.28);
      color: rgba(216,178,92,.92);
      flex:0 0 auto;
    }
  .spark{
    .linkBtn{
  font-family: var(--mono);
  font-size:12px;
  opacity:.9;
  color: rgba(216,178,92,.88);
  text-decoration: underline;
  cursor: pointer;
  display:inline-block;
}
.linkBtn:visited{ color: rgba(216,178,92,.88); }
.linkBtn:hover{ opacity:1; }

  font-family:var(--mono);
  font-size:12px;
  color:rgba(255,255,255,.78);

  position:absolute;
  top:14px;

  /* âœ… å³ä¸Šè§’ï¼šä½†é¿é–‹å³ä¸Šçš„ A/B åœ“è§’æ¨™ç±¤ */
  right:56px;

  padding:4px 8px;
  border-radius:999px;
  background:rgba(0,0,0,.28);
  border:1px solid rgba(216,178,92,.22);
  box-shadow:0 10px 24px rgba(0,0,0,.25);

  /* âœ… ä¸è¦æ“‹åˆ°å¡ç‰‡é»æ“Š */
  pointer-events:none;
}



    .msg{
      margin-top:14px;padding:14px;border-radius:16px;
      background:rgba(0,0,0,.26);
      border: 1px solid rgba(216,178,92,.22);
      color:rgba(255,255,255,.90);
      line-height:1.75;
      white-space:pre-wrap;
      display:none;
    }

    .footer{margin-top:14px;display:flex;justify-content:space-between;gap:12px;align-items:center;flex-wrap:wrap;color:var(--muted);font-size:12.5px;}

    .confetti{position:fixed;inset:0;pointer-events:none;overflow:hidden;z-index:999;display:none;}
    .confetti span{position:absolute;width:10px;height:14px;border-radius:3px;opacity:.95;transform:translateY(-30px) rotate(0deg);animation: fall 1.35s linear forwards;}
    @keyframes fall{to{transform:translateY(calc(100vh + 40px)) rotate(680deg); opacity:1}}

    @media (max-width: 560px){
      .countdown{grid-template-columns: repeat(2, minmax(0, 1fr));}
      .cards{grid-template-columns: 1fr;}
      .pill{display:none}
      .card{padding:22px}
    }
    @media (prefers-reduced-motion: reduce){
      .confetti span{animation:none}
      button,.fate{transition:none}
    }
    /* ===== Pick FX ===== */
.fate{ position:relative; }

.fate.dim{
  opacity:.55;
  filter:saturate(.85) contrast(.95);
}

.fate.glow{
  border-color: rgba(216,178,92,.55);
  box-shadow:
    0 0 0 1px rgba(216,178,92,.18),
    0 18px 45px rgba(0,0,0,.35),
    0 0 26px rgba(216,178,92,.18),
    0 0 50px rgba(139,92,246,.12);
}

.fate.shake{
  animation: fateShake .80s ease-in-out 2;
}

@keyframes fateShake{
  0%{transform:translate(0,0) rotate(0)}
  12%{transform:translate(-4px,2px) rotate(-1.6deg)}
  24%{transform:translate(5px,-3px) rotate(1.8deg)}
  36%{transform:translate(-5px,-2px) rotate(-1.4deg)}
  48%{transform:translate(4px,3px) rotate(1.4deg)}
  60%{transform:translate(-3px,2px) rotate(-1.0deg)}
  72%{transform:translate(3px,-2px) rotate(1.0deg)}
  100%{transform:translate(0,0) rotate(0)}
}

.fate.revealPulse{
  animation: revealPulse .9s ease-out 1;
}

@keyframes revealPulse{
  0%   { transform: scale(1); }
  35%  { transform: scale(1.02); }
  100% { transform: scale(1); }
}

.pickBadge{
  position:absolute;
  top:14px;
  left:14px;
  padding:6px 10px;
  border-radius:999px;
  font-family: var(--mono);
  font-size:11px;
  letter-spacing:.6px;
  text-transform:uppercase;
  color: rgba(216,178,92,.95);
  background: rgba(0,0,0,.38);
  border: 1px solid rgba(216,178,92,.32);
  box-shadow: 0 12px 28px rgba(0,0,0,.35);
  pointer-events:none;
  z-index:3;
}

/* reduce motion */
@media (prefers-reduced-motion: reduce){
  .fate.shake, .fate.revealPulse{ animation:none !important; }
}

  </style>
</head>

<body>
  <div class="confetti" id="confetti"></div>

  <main class="wrap">
    <div class="topbar">
      <div class="brand"><span class="dot"></span><span id="brandText">invitation</span></div>
      <div class="pill">Happy Â· Addie Â· Day</div>
    </div>

    <section class="card" aria-live="polite">
      <h1 id="title">Hey âœ¨</h1>
      <p class="sub" id="subtitle"></p>

      <div class="panel">
        <div style="font-family:var(--mono); color:rgba(255,255,255,.75); font-size:12px;">countdown</div>

        <div class="countdown" aria-label="countdown">
          <div class="tile"><div class="num" id="d">--</div><div class="label">days</div></div>
          <div class="tile"><div class="num" id="h">--</div><div class="label">hours</div></div>
          <div class="tile"><div class="num" id="m">--</div><div class="label">mins</div></div>
          <div class="tile"><div class="num" id="s">--</div><div class="label">secs</div></div>
        </div>

        <div style="color:rgba(255,255,255,.62); font-size:13px; line-height:1.6;">
          <span id="dateLine"></span>
        </div>

        <div class="actions">
          <button class="primary" id="openBtn">Open</button>
          <button class="ghost" id="peekBtn">Tiny hint</button>
        </div>
      </div>

      <div class="divider"></div>

      <div id="flow" style="display:none;">
        <div class="sub" id="openingText"></div>

        <div class="sub" style="margin-top:6px;margin-bottom:8px;color:rgba(255,255,255,.78);">
          é¸ä¸€å¼µå¡ç‰‡å§ã€‚é‚£å¼µå¡ç‰‡æœƒæ±ºå®šâ€”â€”ä½ ä»Šå¹´ç”Ÿæ—¥ã€Œæ€éº¼éã€çš„å‘½é‹ã€‚
        </div>

        <div class="cards" id="cards">
          <div class="fate" id="cardA" role="button" tabindex="0" aria-label="Pick card A">
            <div class="fateTop">
              <div>
                <div class="fateTitle">Card A</div>
                <div class="fateHint">ä½ é¸çš„é‚£å¼µï¼Œæœƒå…ˆå…¬å¸ƒã€‚</div>
              </div>
              <div class="fateLabel">A</div>
            </div>
            <div class="spark">tap to pick</div>
          </div>

          <div class="fate" id="cardB" role="button" tabindex="0" aria-label="Pick card B">
            <div class="fateTop">
              <div>
                <div class="fateTitle">Card B</div>
                <div class="fateHint">å¦ä¸€å¼µæœƒæ™šé»æ­æ›‰ã€‚</div>
              </div>
              <div class="fateLabel">B</div>
            </div>
            <div class="spark">tap to pick</div>
          </div>
        </div>

        <div class="revealGrid" id="revealGrid" style="display:none;">
          <div class="event" id="pickedEvent">
            <div class="eventTitle" id="pickedTitle"></div>
            <div class="eventMeta" id="pickedMeta"></div>
            <div class="mini">
              <a class="linkBtn" id="pickedMap" href="#" target="_blank" rel="noopener noreferrer">Open map</a>
            </div>
          </div>

          <div class="event" id="otherEvent" style="display:none;">
            <div class="eventTitle" id="otherTitle"></div>
            <div class="eventMeta" id="otherMeta"></div>
            <div class="mini">
              <a class="linkBtn" id="otherMap" href="#" target="_blank" rel="noopener noreferrer">Open map</a>
            </div>
          </div>
        </div>

        <div class="msg" id="msg"></div>

        <div class="actions" id="stepActions" style="display:none;">
          <button class="primary" id="revealOtherBtn">çœ‹çœ‹å¦ä¸€å¼µå¡</button>
          <button class="ghost" id="resetBtn">Reset</button>
        </div>

        <div class="actions" id="finalActions" style="display:none;">
          <button class="green" id="copyReplyBtn">Copy reply</button>
          <button class="primary" id="icsBtn">Add to Calendar</button>
          <button class="ghost" id="resetBtn2">Reset</button>
        </div>
      </div>

      <div class="footer">
        <div>Choose your fate âœ¨</div>
        <div style="font-family:var(--mono); font-size:12px; opacity:.8;" id="footRight"></div>
      </div>
    </section>
  </main>

<script>
  // =========================
  // EDIT HEREï¼ˆåªæ”¹é€™å€ï¼‰
  // =========================
  const CONFIG = {
    to: "Addie",
    from: "Liz",

    countdownTo: "2026-03-06T00:00",
  // âœ… æ”¹æˆä¸€èˆ¬å­—ä¸²ï¼ˆé¿å…é¡æ–‡å­—è£¡çš„ ` åå¼•è™Ÿç‚¸æ‰ï¼‰
  openingText:
    "å˜»å˜»æƒ³ä¸åˆ°å§ é›–ç„¶æ²’æœ‰ç”¨ç¶²é è·Ÿä½ å‘Šç™½\n" +
    "ä½†é‚„æ˜¯å¯ä»¥ç”¨ç¶²é çµ¦ä½ é©šå–œçš„ï½¡:.ï¾Ÿãƒ½(*Â´âˆ€`)ï¾‰ï¾Ÿ.:ï½¡\n" +
    "ï¼ˆä¾ç…§ç›´è¦ºé¸å°±å£ä»¥å›‰ğŸ¥°ã€‚ï¼‰",

    cardA: {
      dateLabel: "2026/3/6ï¼ˆäº”ï¼‰",
      title: "A CUT Â· åœ‹è³“",
      time: "19:00",
      note: "æ­å–œä½ é¸åˆ°å…¨ä¸–ç•Œæœ€æœ‰ç”¨çš„èº«å¿ƒéˆèª²ç¨‹\nåªè¦äººå‡ºç¾å°±å¥½ğŸ’•",
      mapUrl: "https://maps.app.goo.gl/hT77xj62Pigd9uqaA"
    },
    cardB: {
      dateLabel: "2026/3/7ï¼ˆå…­ï¼‰",
      title: "æ¼¢ä¾†é£¯åº—ä¸€æ™š",
      time: "Check-in æ™‚é–“æˆ‘å€‘å†ä¸€èµ·æ±ºå®š",
      note: "Nice and fancyçš„é£¯åº—ä½å¥½ä½æ»¿\néš”å¤©æ—©ä¸Šé‚„æœ‰å³¶èªæ—©é¤buffetå”·ï¼",
      mapUrl: "https://maps.app.goo.gl/Goks6L1aohtFGdAAA"
    },

    twistText:
`å“ˆå“ˆï¼Œä½†å…¶å¯¦â€”â€”
æˆ‘å…©å€‹éƒ½è¨‚å¥½äº†é¡†é¡†ğŸ˜‰

æ‰€ä»¥ä½ ç”Ÿæ—¥é‚£é€±çš„è¡Œç¨‹æœƒé•·é€™æ¨£ï¼š
3/6 å»åƒ A CUTï¼Œ
3/7 å»æ¼¢ä¾†ä½ä¸€æ™šã€‚`
  };

  // ---- helpers ----
  const el = (id) => document.getElementById(id);
  const prefersReduced = (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) || false;

  function parseLocalDateTime(s){
    const parts = s.split("T");
    const date = parts[0];
    const time = parts[1] || "00:00";
    const ymd = date.split("-").map(Number);
    const hm = time.split(":").map(Number);
    return new Date(ymd[0], ymd[1]-1, ymd[2], hm[0] || 0, hm[1] || 0, 0);
  }

  function fmtDateLine(dt){
    const w = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][dt.getDay()];
    return "counting down to: " +
      dt.getFullYear() + "/" + (dt.getMonth()+1) + "/" + dt.getDate() + " " +
      String(dt.getHours()).padStart(2,"0") + ":" + String(dt.getMinutes()).padStart(2,"0") +
      " (" + w + ")";
  }

  async function copyToClipboard(text){
    try { await navigator.clipboard.writeText(text); return true; }
    catch {
      try{
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        return true;
      } catch { return false; }
    }
  }

  function confettiBurst(){
    if (prefersReduced) return;
    const layer = el("confetti");
    layer.innerHTML = "";
    layer.style.display = "block";
    const n = 70;
    for (let i=0;i<n;i++){
      const s = document.createElement("span");
      s.style.left = (Math.random()*100) + "vw";
      s.style.top = (-20 - Math.random()*30) + "px";
      s.style.animationDelay = (Math.random()*0.35) + "s";
      s.style.width = (8 + Math.random()*8) + "px";
      s.style.height = (10 + Math.random()*10) + "px";
      const hue = Math.floor(Math.random()*360);
      s.style.background = "hsl(" + hue + " 90% 60%)";
      layer.appendChild(s);
    }
    setTimeout(() => { layer.style.display="none"; layer.innerHTML=""; }, 1700);
  }

  function openMap(url){
    if (!url){
      el("msg").style.display = "block";
      el("msg").textContent = "æˆ‘é‚„æ²’æŠŠåœ°åœ–é€£çµè²¼ä¸Šå» ğŸ˜¶\nï¼ˆä½ æ™šé»å¯ä»¥æŠŠ CONFIG.cardA.mapUrl / cardB.mapUrl è£œä¸Šï¼‰";
      return;
    }
    window.open(url, "_blank", "noopener,noreferrer");
  }

  function pad2(n){ return String(n).padStart(2,"0"); }
  function toICSLocal(y,m,d,hh,mm){ return "" + y + pad2(m) + pad2(d) + "T" + pad2(hh) + pad2(mm) + "00"; }
  function escICS(s){
    return (s||"")
      .replace(/\\/g,"\\\\")
      .replace(/\n/g,"\\n")
      .replace(/,/g,"\\,")
      .replace(/;/g,"\\;");
  }

  function init(){
    // ---- hydrate header ----
    el("title").textContent = "Hi, " + CONFIG.to + " âœ¨";
    el("subtitle").textContent = "From: " + CONFIG.from + "\nè·é›¢ä½ çš„ç”Ÿæ—¥é‚„å‰©ä¸‹ï¼š";
    el("brandText").textContent = "to:" + (CONFIG.to || "you").toLowerCase();
    el("footRight").textContent = "from:" + (CONFIG.from || "").toLowerCase();
    el("openingText").textContent = CONFIG.openingText;

    // ---- countdown ----
    const target = parseLocalDateTime(CONFIG.countdownTo);
    el("dateLine").textContent = fmtDateLine(target);

    function tick(){
      const now = new Date();
      let diff = target.getTime() - now.getTime();
      if (diff <= 0){
        el("d").textContent = "0";
        el("h").textContent = "0";
        el("m").textContent = "0";
        el("s").textContent = "0";
        return;
      }
      const sec = Math.floor(diff / 1000);
      el("d").textContent = String(Math.floor(sec / 86400));
      el("h").textContent = String(Math.floor((sec % 86400) / 3600));
      el("m").textContent = String(Math.floor((sec % 3600) / 60));
      el("s").textContent = String(sec % 60);
    }
    tick();
    setInterval(tick, 1000);

    // ---- flow open ----
    const flow = el("flow");
    el("openBtn").addEventListener("click", () => {
      flow.style.display = "block";
      confettiBurst();
      flow.scrollIntoView({ behavior: prefersReduced ? "auto" : "smooth", block: "start" });
    });

    el("peekBtn").addEventListener("click", () => {
      el("peekBtn").textContent = "hint: choose a card. fate decides.";
      setTimeout(() => el("peekBtn").textContent = "Tiny hint", 1600);
    });

    // ---- pick logic ----
    const cardA = el("cardA");
    const cardB = el("cardB");
    const revealGrid = el("revealGrid");
    const otherEvent = el("otherEvent");
    const msg = el("msg");
    const stepActions = el("stepActions");
    const finalActions = el("finalActions");

    let picked = null;  // "A" or "B"
    let step = 0;       // 0 pick, 1 picked shown, 2 other shown + twist

    function setCardDisabled(disabled){
      [cardA, cardB].forEach(c => {
        c.classList.toggle("disabled", disabled);
        c.setAttribute("aria-disabled", disabled ? "true" : "false");
      });
    }

    function renderPicked(which){
      const pickedData = which === "A" ? CONFIG.cardA : CONFIG.cardB;
      const otherData  = which === "A" ? CONFIG.cardB : CONFIG.cardA;

      el("pickedTitle").textContent = "ä½ é¸åˆ°çš„æ˜¯ï¼š" + pickedData.title;
      el("pickedMeta").textContent = pickedData.dateLabel + "\n" + pickedData.time + "\n" + pickedData.note;

      el("otherTitle").textContent = "å¦ä¸€å¼µæ˜¯ï¼š" + otherData.title;
      el("otherMeta").textContent = otherData.dateLabel + "\n" + otherData.time + "\n" + otherData.note;

const pickedLink = el("pickedMap");
const otherLink  = el("otherMap");

pickedLink.href = pickedData.mapUrl || "#";
otherLink.href  = otherData.mapUrl  || "#";

// å¦‚æœæ²’é€£çµï¼Œå°±ä¸è¦è·³èµ°ï¼Œæ”¹é¡¯ç¤ºä½ çš„æç¤ºè¨Šæ¯
pickedLink.onclick = (e) => {
  if (!pickedData.mapUrl) { e.preventDefault(); openMap(""); }
};
otherLink.onclick = (e) => {
  if (!otherData.mapUrl) { e.preventDefault(); openMap(""); }
};

    }
function clearPickFX(){
  [cardA, cardB].forEach(c => {
    c.classList.remove("dim","glow","shake","revealPulse");
    const b = c.querySelector(".pickBadge");
    if (b) b.remove();
  });
}

function addPickBadge(which){
  const pickedEl = which === "A" ? cardA : cardB;
  const badge = document.createElement("div");
  badge.className = "pickBadge";
  badge.textContent = "YOU CHOSE";
  pickedEl.appendChild(badge);
}

function onPick(which){
  if (step !== 0) return;

  picked = which;
  step = 1;

  // æ¸…æ‰ä¸Šä¸€æ¬¡ç‹€æ…‹ï¼ˆä»¥é˜² reset å¾Œæ®˜ç•™ï¼‰
  clearPickFX();

  const pickedEl = which === "A" ? cardA : cardB;
  const otherEl  = which === "A" ? cardB : cardA;

  setCardDisabled(true);

  // å…ˆä¸æ­æ›‰å¡ç‰‡å…§å®¹
  revealGrid.style.display = "none";
  otherEvent.style.display = "none";
  stepActions.style.display = "none";
  finalActions.style.display = "none";

  // æŠ½ç‰Œç‰¹æ•ˆï¼šä½ é¸çš„ç™¼å…‰+æŠ–ï¼Œå¦ä¸€å¼µè®Šæ·¡
  pickedEl.classList.add("glow","shake");
  otherEl.classList.add("dim");

  msg.style.display = "block";
  msg.textContent = "æŠ½ç‰Œä¸­â€¦\nï¼ˆè«‹ä¿æŒç¥ç§˜æ„ŸğŸ˜Œï¼‰";
  confettiBurst();

  // æŠ–å®Œå¾Œç§»é™¤ shakeï¼ˆä¿ç•™ glowï¼‰
  setTimeout(() => pickedEl.classList.remove("shake"), 850);

  // ç¬¬äºŒæ®µæ–‡å­—ï¼šå‘½é‹å·²æ±ºå®šâ€¦
  setTimeout(() => {
    msg.textContent = "å‘½é‹å·²æ±ºå®šâ€¦\nï¼ˆå…ˆè®“æˆ‘å…¬å¸ƒä½ é¸åˆ°çš„é‚£å¼µã„…ğŸ˜—ï¼‰";
  }, 700);

  // æœ€å¾Œæ‰æ­æ›‰å…§å®¹ + å‡ºç¾ YOU CHOSE å¾½ç« 
  setTimeout(() => {
    renderPicked(which);
    revealGrid.style.display = "block";
    stepActions.style.display = "flex";

    addPickBadge(which);
    pickedEl.classList.add("revealPulse");
    setTimeout(() => pickedEl.classList.remove("revealPulse"), 950);

    revealGrid.scrollIntoView({
      behavior: prefersReduced ? "auto" : "smooth",
      block: "start"
    });
  }, 1600);
}



    // âœ… ç¶äº‹ä»¶ï¼ˆä¸€å®šåœ¨ onPick å¤–é¢ï¼‰
    cardA.addEventListener("click", () => onPick("A"));
    cardB.addEventListener("click", () => onPick("B"));
    cardA.addEventListener("keydown", (e) => { if (e.key === "Enter" || e.key === " ") { e.preventDefault(); onPick("A"); } });
    cardB.addEventListener("keydown", (e) => { if (e.key === "Enter" || e.key === " ") { e.preventDefault(); onPick("B"); } });

    el("revealOtherBtn").addEventListener("click", () => {
      if (step !== 1) return;
      step = 2;
      otherEvent.style.display = "block";
      msg.style.display = "block";
      msg.textContent = CONFIG.twistText;
      confettiBurst();
      stepActions.style.display = "none";
      finalActions.style.display = "flex";
      otherEvent.scrollIntoView({ behavior: prefersReduced ? "auto" : "smooth", block: "start" });
    });

   function resetAll(){
  picked = null;
  step = 0;

  clearPickFX();          // â† æ–°å¢ï¼šæ¸…å¾½ç« +ç‰¹æ•ˆ
  setCardDisabled(false);

  revealGrid.style.display = "none";
  otherEvent.style.display = "none";
  msg.style.display = "none";
  msg.textContent = "";

  stepActions.style.display = "none";
  finalActions.style.display = "none";
}

    el("resetBtn").addEventListener("click", resetAll);
    el("resetBtn2").addEventListener("click", resetAll);

    el("copyReplyBtn").addEventListener("click", async () => {
      const txt =
`æˆ‘é¸åˆ°çš„æ˜¯ Card ${picked || "?"} ğŸ˜†
ä½†ä½ é‚£å¥ã€Œå“ˆå“ˆå…¶å¯¦æˆ‘éƒ½è¨‚äº†ã€å¤ªçŠ¯è¦äº†ã€‚

æˆ‘OKï¼3/6 A CUT + 3/7 æ¼¢ä¾†ï¼Œèµ°ã€‚`;
      const ok = await copyToClipboard(txt);
      msg.style.display = "block";
      msg.textContent = ok ? "Copied âœ¨ï¼ˆå¯ä»¥ç›´æ¥è²¼å›è¨Šæ¯çµ¦æˆ‘ï¼‰" : "Copy failed";
    });

    function buildICS(){
      const e1 = parseLocalDateTime(CONFIG.countdownTo);
      const e1end = new Date(e1.getTime() + 2*60*60*1000);

      const y = e1.getFullYear();
      const e2 = new Date(y, 2, 7, 20, 0, 0);
      const e2end = new Date(e2.getTime() + 12*60*60*1000);

      const uidBase = Date.now() + "-" + Math.random().toString(16).slice(2);

      const lines = [
        "BEGIN:VCALENDAR",
        "VERSION:2.0",
        "PRODID:-//fate-cards//birthday//ZH",
        "CALSCALE:GREGORIAN",
        "METHOD:PUBLISH",

        "BEGIN:VEVENT",
        "UID:" + uidBase + "-1@inv",
        "DTSTAMP:" + toICSLocal(e1.getFullYear(), e1.getMonth()+1, e1.getDate(), e1.getHours(), e1.getMinutes()),
        "DTSTART:" + toICSLocal(e1.getFullYear(), e1.getMonth()+1, e1.getDate(), e1.getHours(), e1.getMinutes()),
        "DTEND:" + toICSLocal(e1end.getFullYear(), e1end.getMonth()+1, e1end.getDate(), e1end.getHours(), e1end.getMinutes()),
        "SUMMARY:" + escICS("Birthday Dinner Â· " + CONFIG.cardA.title),
        "DESCRIPTION:" + escICS(CONFIG.cardA.note + "\n\nFrom: " + CONFIG.from),
        CONFIG.cardA.mapUrl ? ("URL:" + escICS(CONFIG.cardA.mapUrl)) : "",
        "END:VEVENT",

        "BEGIN:VEVENT",
        "UID:" + uidBase + "-2@inv",
        "DTSTAMP:" + toICSLocal(e2.getFullYear(), e2.getMonth()+1, e2.getDate(), e2.getHours(), e2.getMinutes()),
        "DTSTART:" + toICSLocal(e2.getFullYear(), e2.getMonth()+1, e2.getDate(), e2.getHours(), e2.getMinutes()),
        "DTEND:" + toICSLocal(e2end.getFullYear(), e2end.getMonth()+1, e2end.getDate(), e2end.getHours(), e2end.getMinutes()),
        "SUMMARY:" + escICS("Overnight Â· " + CONFIG.cardB.title),
        "DESCRIPTION:" + escICS(CONFIG.cardB.note + "\n\nFrom: " + CONFIG.from),
        CONFIG.cardB.mapUrl ? ("URL:" + escICS(CONFIG.cardB.mapUrl)) : "",
        "END:VEVENT",

        "END:VCALENDAR"
      ].filter(Boolean);

      return lines.join("\r\n");
    }

    el("icsBtn").addEventListener("click", () => {
      const ics = buildICS();
      const blob = new Blob([ics], { type: "text/calendar;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "birthday-fate-cards.ics";
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(() => URL.revokeObjectURL(url), 800);

      msg.style.display = "block";
      msg.textContent = "å·²ä¸‹è¼‰è¡Œäº‹æ›†æª”ï¼ˆ.icsï¼‰âœ¨\nä½ å¯ä»¥åŠ åˆ°æ‰‹æ©Ÿè¡Œäº‹æ›†ã€‚";
    });
  }

  // âœ… æœ€ç©©çš„å•Ÿå‹•æ–¹å¼
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", init);
  } else {
    init();
  }
</script>

</body>
</html>
